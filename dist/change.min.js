class Idb{static#READ_ONLY="readonly";static#READ_WRITE="readwrite";#db=void 0;#upgradeCallback=void 0;static#connectedIdbs=[];static async of(t,e){var n=Idb.#connectedIdbs.find(e=>e.#db.name===t);return n||(n=await Idb.#open(t,void 0,e),n=new Idb(n,e),Idb.#connectedIdbs.push(n),n)}constructor(e,t){this.#db=e,this.#upgradeCallback=t}static#open(s,i,a){return new Promise((t,n)=>{var e;window.indexedDB&&((e=indexedDB.open(s,i)).onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{n(new Error("Database error: "+e.target.error))},e.onupgradeneeded=e=>{var t,n=e.target.result;a&&(t=(new Date).getFullYear(),a(n,e.oldVersion,e.newVersion,[t]))})})}openCursor(i){return new Promise(e=>{var t=this.getStoreTransaction(i,Idb.#READ_ONLY),n=t[0],t=t[1];const s=[];n.openCursor().onsuccess=e=>{e=e.target.result;e&&(s.push(e.value),e.continue())},t.oncomplete=()=>{e(s)}})}insert(i,a,r){return new Promise((t,n)=>{var e=this.getStoreTransaction(i,Idb.#READ_WRITE)[0];let s;(s=r?e.put(a,r):e.put(a)).onsuccess=e=>{t([e.target.result,a])},s.onerror=e=>{n(e.target.errorCode)}})}get(e,s){return new Promise((t,n)=>{this.getStoreTransaction(e,Idb.#READ_ONLY)[0].get(s).onsuccess=e=>{e.target.result?(e=e.target.result,t(e)):n(new Error(`The value with key ${s} not found`))}})}getAllByIndex(i,a,r){return new Promise(e=>{var t=this.getStoreTransaction(i,Idb.#READ_ONLY),n=t[0],t=t[1];const s=[];n.index(a).openCursor(r).onsuccess=e=>{e=e.target.result;e&&(e.value.id=e.primaryKey,s.push(e.value),e.continue())},t.oncomplete=()=>{e(s)}})}getAll(a){return new Promise(e=>{var t=this.getStoreTransaction(a,Idb.#READ_ONLY),n=t[0],t=t[1];let s=[];const i=n.getAll();i.onsuccess=()=>{s=i.result},t.oncomplete=()=>{e(s)}})}count(n){return new Promise(e=>{const t=this.getStoreTransaction(n,Idb.#READ_ONLY)[0].count();t.onsuccess=()=>{e(t.result)}})}clear(s){return new Promise((t,n)=>{var e=this.getStoreTransaction(s,Idb.#READ_WRITE)[0].clear();e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(e.target.errorCode)}})}delete(s,i){return new Promise((t,n)=>{var e=this.getStoreTransaction(s,Idb.#READ_WRITE)[0].delete(i);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(e)}})}async putAll(a,r){return new Promise(t=>{var[n,e]=this.getStoreTransaction(a,Idb.#READ_WRITE);for(let e=0;e<r.length;e+=1){var s=r[e],i=r[e].id;i?n.put(s,i):n.put(s)}e.oncomplete=e=>{t([e.target.result])}})}async updateAll(i,a){return new Promise(t=>{var[n,e]=this.getStoreTransaction(i,Idb.#READ_WRITE);for(let e=0;e<a.length;e+=1){var s=a[e];n.put(s.value,s.key)}e.oncomplete=e=>{t([e.target.result])}})}hasObjectStore(e){return!!this.#db.objectStoreNames.contains(e)}getObjectStores(){var t=[],n=this.#db.objectStoreNames;for(let e=0;e<n.length;e+=1)t.push(n.item(e));return t}createObjectStores(i){return new Promise((t,n)=>{var{name:e,version:s}=this.#db,e=(this.#db.close(),indexedDB.open(e,s+1));e.onsuccess=e=>{e=e.target.result;this.#db=e,t(e)},e.onerror=e=>{n(new Error("Database error: "+e.target.error))},e.onupgradeneeded=e=>{var t=e.target.result;this.#upgradeCallback&&this.#upgradeCallback(t,e.oldVersion,e.newVersion,i)},e.onblocked=e=>{throw Error("Request was blocked: "+e.newVersion)}})}getStoreTransaction(e,t){if(this.#db.objectStoreNames.contains(e))return[(t=this.#db.transaction(e,t)).objectStore(e),t]}}class Statement{static INCOME="Income";static EXPENSE="Expense";static SAVING="Saving";constructor(e,t,n){this.id=e,this.name=t,this.type=n,this.categories=[]}}class Category{constructor(e,t){this.id=e,this.name=t,this.goals=[]}}class PlanningCache{static DATABASE_NAME="Planning";static PLANNING_TEMPLATE_URI="static/js/planning.json";idb=void 0;static async getAll(){var t=await Idb.of(PlanningCache.DATABASE_NAME,PlanningCache.upgradePlanningDatabase),n=t.getObjectStores(),s=new Array(n.length),i=[];for(let e=0;e<n.length;e+=1){var a=n[e],a=new PlanningCache(a,t);s[e]=a,i.push(a.init())}return await Promise.all(i),s}static upgradePlanningDatabase(e,t,n){n&&e.createObjectStore(n,{autoIncrement:!0}).createIndex("byType","type",{unique:!1})}constructor(e,t){this.idb=t||Idb.of(PlanningCache.DATABASE_NAME,PlanningCache.upgradePlanningDatabase),this.year=+e}async init(){0===await this.idb.count(this.year)&&await fetch(PlanningCache.PLANNING_TEMPLATE_URI).then(e=>e.json()).then(e=>this.idb.putAll(this.year,e))}async readAll(){return this.idb.openCursor(this.year)}async updateAll(e){await this.idb.clear(this.year),await this.idb.putAll(this.year,e)}async readExpenseCategories(){var e=IDBKeyRange.only("Expense"),t=await this.idb.getAllByIndex(this.year,"byType",e),n=[];for(let e=0;e<t.length;e+=1)n.push(...t[e].categories);return n}async readCategories(){return this.idb.openCursor(this.year)}async read(e){return this.idb.get(this.year,e)}async update(e,t){await this.idb.insert(this.year,t,e)}async delete(e){await this.idb.delete(this.year,e)}}class GraphicEffects{constructor(){this.rootContainer=void 0,this.mouseDown=!1,this.scrolling=void 0,this.currentIndex=1,this.startX=0,this.startY=0,this.startSliderEventListener=this.startSlider.bind(this),this.moveSliderEventListener=this.moveSlider.bind(this),this.endSliderEventListener=this.endSlider.bind(this),this.refreshEventListener=this.refresh.bind(this),this.navOpen=!1}init(e){this.rootContainer=e,this.sliderWrapper=this.rootContainer.querySelector(".section"),this.lastIndex=this.sliderWrapper.children.length+1,this.slices=this.rootContainer.querySelectorAll(".slice"),this.slices.forEach((e,t)=>{e.setAttribute("data-slice-index",t)}),this.currentIndex=0,this.sliderWrapper.addEventListener("mousedown",this.startSliderEventListener),this.sliderWrapper.addEventListener("touchmove",this.startSliderEventListener,{passive:!0}),window.addEventListener("mouseup",this.endSliderEventListener),window.addEventListener("touchend",this.endSliderEventListener),window.addEventListener("resize",this.refreshEventListener,!0),this.$main=document.getElementById("main"),this.$sidenav_left=document.getElementById("sidenav"),this.$sidenav_right=this.$sidenav_left.cloneNode(!0),this.$sidenav_left.classList.add("sidenav-left"),this.$sidenav_right.classList.add("sidenav-right"),this.$sidenav_left.parentNode.appendChild(this.$sidenav_right),document.querySelectorAll(".nav-trigger").forEach(e=>e.addEventListener("click",this.openNav.bind(this)))}slideTo(e){this.containerWidth||(this.containerWidth=this.rootContainer.clientWidth),this.currentIndex=+e,this.currentIndex=Math.min(this.currentIndex,this.lastIndex),requestAnimationFrame(()=>{this.sliderWrapper.style.transition="transform 0.2s linear",this.sliderWrapper.style.transform=`translateX(${-this.containerWidth*e}px)`})}selectedIndex(){return this.currentIndex}onClickSetSlice(e){e=e.target.getAttribute("data-slice-index");this.slideTo(e)}startSlider(e){this.mouseDown=!0,this.containerWidth||(this.containerWidth=this.rootContainer.clientWidth),this.startX=e.clientX||e.touches[0].screenX,this.startY=e.clientY||e.touches[0].screenY,this.sliderWrapper.removeEventListener("touchmove",this.startSliderEventListener),this.sliderWrapper.style.transition="transform 0s linear",this.rootContainer.addEventListener(e.clientX?"mousemove":"touchmove",this.moveSliderEventListener,{passive:!0})}moveSlider(e){if(this.mouseDown){const t=e.clientX||e.touches[0].screenX,n=e.clientY||e.touches[0].screenY;requestAnimationFrame(()=>{if(!this.scrolling){if(10<Math.abs(n-this.startY))return this.scrolling="vertical",void this.slideTo(this.currentIndex);10<Math.abs(t-this.startX)&&(this.scrolling="horizontal")}var e;void 0!==this.scrolling&&"horizontal"!==this.scrolling||(e=t-this.startX-this.containerWidth*this.currentIndex,this.sliderWrapper.style.transform=`translateX(${e}px)`)})}}endSlider(e){}refresh(){this.containerWidth=this.rootContainer.clientWidth,this.slideTo(this.currentIndex)}openNav(e){e=e.currentTarget.dataset.side;if("left"===e){if("left"===this.navOpen)return void this.closeNav();this.$sidenav_right.classList.remove("sidenav-open"),this.$sidenav_left.classList.add("sidenav-open"),this.$main.classList.remove("main-shift-right"),this.$main.classList.add("main-shift-left"),this.navOpen="left"}else if("right"===e){if("right"===this.navOpen)return void this.closeNav();this.$sidenav_left.classList.remove("sidenav-open"),this.$sidenav_right.classList.add("sidenav-open"),this.$main.classList.remove("main-shift-left"),this.$main.classList.add("main-shift-right"),this.navOpen="right"}this.$main.addEventListener("transitionend",function e(){this.$main.removeEventListener("transitionend",e),this.refresh()}.bind(this))}closeNav(){this.$sidenav_left.classList.remove("sidenav-open"),this.$sidenav_right.classList.remove("sidenav-open"),this.$main.classList.remove("main-shift-left"),this.$main.classList.remove("main-shift-right"),this.navOpen=void 0,this.$main.addEventListener("transitionend",function e(){this.$main.removeEventListener("transitionend",e),this.refresh()}.bind(this))}}function create(e,t,n){const s=document.createElement(e);return t&&Object.entries(t).forEach(([e,t])=>{"classes"===e?s.classList.add(...t):s[e]=t}),n&&n.appendChild(s),s}function createChild(e,t){e=document.createElement(e);return t.appendChild(e),e}function createImageButton(e,t,n,s,i){var a=create("button"),t=(a.classList.add(...t),create("img"));return t.classList.add("white-fill"),t.textContent=e,t.alt=e,t.src=n,a.appendChild(t),s&&s.appendChild(a),i&&a.addEventListener("click",i),a}class icons{static save="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z' /%3E%3C/svg%3E";static edit="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z' /%3E%3C/svg%3E";static delete="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z' /%3E%3C/svg%3E";static delete_file="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M22.54 21.12L20.41 19L22.54 16.88L21.12 15.46L19 17.59L16.88 15.46L15.46 16.88L17.59 19L15.46 21.12L16.88 22.54L19 20.41L21.12 22.54M6 2C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H13.81C13.45 21.38 13.2 20.7 13.08 20H6V4H13V9H18V13.08C18.33 13.03 18.67 13 19 13C19.34 13 19.67 13.03 20 13.08V8L14 2M8 12V14H16V12M8 16V18H13V16Z' /%3E%3C/svg%3E";static hand_coin="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M16 2C13.24 2 11 4.24 11 7S13.24 12 16 12 21 9.76 21 7 18.76 2 16 2M16 10C14.34 10 13 8.66 13 7S14.34 4 16 4 19 5.34 19 7 17.66 10 16 10M19 16H17C17 14.8 16.25 13.72 15.13 13.3L8.97 11H1V22H7V20.56L14 22.5L22 20V19C22 17.34 20.66 16 19 16M5 20H3V13H5V20M13.97 20.41L7 18.5V13H8.61L14.43 15.17C14.77 15.3 15 15.63 15 16C15 16 13 15.95 12.7 15.85L10.32 15.06L9.69 16.96L12.07 17.75C12.58 17.92 13.11 18 13.65 18H19C19.39 18 19.74 18.24 19.9 18.57L13.97 20.41Z' /%3E%3C/svg%3E";static menu="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z' /%3E%3C/svg%3E";static add_row="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M22,10A2,2 0 0,1 20,12H4A2,2 0 0,1 2,10V3H4V5H8V3H10V5H14V3H16V5H20V3H22V10M4,10H8V7H4V10M10,10H14V7H10V10M20,10V7H16V10H20M11,14H13V17H16V19H13V22H11V19H8V17H11V14Z' /%3E%3C/svg%3E";static add_table="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12.35 20H10V17H12.09C12.21 16.28 12.46 15.61 12.81 15H10V12H14V13.54C14.58 13 15.25 12.61 16 12.35V12H20V12.35C20.75 12.61 21.42 13 22 13.54V5C22 3.9 21.1 3 20 3H4C2.9 3 2 3.9 2 5V20C2 21.1 2.9 22 4 22H13.54C13 21.42 12.61 20.75 12.35 20M16 7H20V10H16V7M10 7H14V10H10V7M8 20H4V17H8V20M8 15H4V12H8V15M8 10H4V7H8V10M17 14H19V17H22V19H19V22H17V19H14V17H17V14' /%3E%3C/svg%3E";static add_file="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M23 18H20V15H18V18H15V20H18V23H20V20H23M6 2C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H13.81C13.45 21.38 13.2 20.7 13.08 20H6V4H13V9H18V13.08C18.33 13.03 18.67 13 19 13C19.34 13 19.67 13.03 20 13.08V8L14 2M8 12V14H16V12M8 16V18H13V16Z' /%3E%3C/svg%3E";static add="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z' /%3E%3C/svg%3E";static summary="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z' /%3E%3C/svg%3E"}class PlanningScreen{onClickUpdate=void 0;constructor(e,t){this.statements=t,this.id=e,this.editMode=!1}init(){this.gfx=new GraphicEffects,this.container=this.sketchAsFragment(),this.navbar=this.sketchNavBar()}sketchAsFragment(){var e=create("div",{id:this.id,classes:["container"]}),t=create("div",{classes:["section"]});for(let e=0;e<this.statements.length;e+=1){var n=this.statements[e],s=this.sketchStatement(n);s.userData=n,t.appendChild(s)}return e.appendChild(t),e}sketchStatement(e){var t=create("div",{classes:["slice"]}),n=create("h1",{textContent:e.name}),s=(n.setAttribute("editable","true"),n.addEventListener("keyup",this.onKeyUpStatementName.bind(this),!1),this.editMode&&n.setAttribute("contenteditable","true"),create("span",{textContent:"▼",classes:["white-50"]})),i=create("div",{classes:["dropdown-content","top-round","bot-round"]}),a=(i.style.display="none",create("h2",{classes:[],textContent:this.statements[0].type+" "})),r=(a.addEventListener("click",this.onClickDropup.bind(this,i)),a.setAttribute("hideable","true"),this.editMode||(a.style.display="none"),create("div",{textContent:Statement.EXPENSE})),r=(r.addEventListener("click",this.onClickChangeStatementType.bind(this)),i.appendChild(r),create("div",{textContent:Statement.INCOME})),r=(r.addEventListener("click",this.onClickChangeStatementType.bind(this)),i.appendChild(r),create("div",{textContent:Statement.SAVING})),r=(r.addEventListener("click",this.onClickChangeStatementType.bind(this)),i.appendChild(r),a.appendChild(s),a.appendChild(i),createImageButton("Add Category",[],icons.add_table,void 0,this.onClickAddCategory.bind(this))),s=(r.setAttribute("hideable","true"),this.editMode||(r.style.display="none"),t.appendChild(n),t.appendChild(a),this.sketchCategory(e.categories));return t.appendChild(s),t.appendChild(r),t}sketchCategory(t){var n=document.createDocumentFragment();for(let e=0;e<t.length;e+=1){var s=t[e],i=create("table",{id:s.id,classes:["top-round","bot-round"]}),a=(n.appendChild(i),createChild("thead",i)),a=(createChild("tbody",i),i.userData=s,createChild("tr",a)),r=create("th",{textContent:s.name},a),r=(r.setAttribute("editable","true"),this.editMode&&r.setAttribute("contenteditable","true"),r.addEventListener("keyup",this.onKeyUpCategoryName.bind(this),!1),create("th",{textContent:"Daily"},a),create("th",{textContent:"Monthly"},a),create("th",{textContent:"Yearly"},a),createChild("th",a));createImageButton("Delete Row",[],icons.delete,r,this.onClickDeleteCategory.bind(this)),r.setAttribute("hideable","true"),this.editMode||(r.style.display="none");for(let e=0;e<s.goals.length;e+=1){var o=s.goals[e],l=createImageButton("Delete goal",[],icons.delete,void 0,this.onClickDeleteGoal.bind(this));this.sketchRow(i,o,{index:-1,hideLastCell:!0,lastCellContent:l})}this.recomputeTotal(i,!0)}return n}sketchRow(e,t,n){let s=-1;Object.prototype.hasOwnProperty.call(n,"index")&&(s=n.index);e=e.tBodies[0].insertRow(s),e.id=t.id,e.userData=t,this.sketchDataCell(e,t.name,n),this.sketchDataCell(e,t.daily,n),this.sketchDataCell(e,t.monthly,n),this.sketchDataCell(e,t.yearly,n),t=e.insertCell(-1);return n?.lastCellContent&&t.appendChild(n.lastCellContent),t.setAttribute("hideable","true"),n?.hideLastCell&&!this.editMode&&(t.style.display="none"),e}sketchDataCell(e,t,n){e=e.insertCell(-1);return e.textContent=t,n?.readonly||(e.setAttribute("editable","true"),this.editMode&&e.setAttribute("contenteditable","true"),e.addEventListener("keyup",this.onKeyUpGoal.bind(this),!1)),n?.color&&(e.style.color=n.color),e}activate(){var e=document.getElementById("main");e.appendChild(this.container),e.appendChild(this.navbar),this.gfx.init(this.container)}sketchNavBar(){var e=create("nav"),t=create("div",{classes:["nav-header"]},e),n=createImageButton("Add",["nav-item"],icons.add_file,t,this.onClickAddStatement.bind(this)),t=(this.editButton=createImageButton("Edit",["nav-item"],icons.edit,t,this.onClickEdit.bind(this)),this.saveButton=createImageButton("Save",["nav-item"],icons.save,void 0,this.onClickSave.bind(this)),createImageButton("Add",["nav-item"],icons.delete_file,t,this.onClickDeleteStatement.bind(this))),n=(n.style.display="none",n.setAttribute("hideable",!0),t.style.display="none",t.setAttribute("hideable",!0),create("div",{classes:["nav-footer"]},e)),t=(createImageButton("Menu",["nav-item","nav-trigger"],icons.menu,n).setAttribute("data-side","left"),create("span",{textContent:"▲",classes:["white-50"]})),s=create("button",{classes:["nav-item"],textContent:this.statements[0].name+" "},n),i=create("div",{classes:["dropup-content","top-round"]});i.style.display="none",s.addEventListener("click",this.onClickDropup.bind(this,i));for(let e=0;e<this.statements.length;e+=1){var a=create("div",{textContent:this.statements[e].name});a.setAttribute("data-slice-index",e),a.addEventListener("click",this.onClickShowStatement.bind(this,s)),i.appendChild(a)}return s.appendChild(t),e.appendChild(i),createImageButton("Menu",["nav-item","nav-trigger"],icons.menu,n).setAttribute("data-side","right"),e}refresh(e){this.statements=e;e=this.sketchAsFragment();document.getElementById("main").replaceChild(e,this.container),this.container=e}recomputeTotal(t,e=!1){let n;var s={id:t.id+"Total",name:"Total",daily:0,monthly:0,yearly:0};n=e?(e=createImageButton("Delete goal",["nav-item"],icons.add_row,void 0,this.onClickAddGoal.bind(this)),this.sketchRow(t,s,{readonly:!0,hideLastCell:!0,lastCellContent:e})):t.tBodies[0].rows[t.tBodies[0].rows.length-1];let i=0,a=0,r=0;for(let e=0;e<t.tBodies[0].rows.length-1;e+=1){var o=t.tBodies[0].rows[e];i+=parseInt(o.cells[1].textContent,10),a+=parseInt(o.cells[2].textContent,10),r+=parseInt(o.cells[3].textContent,10)}n.cells[1].textContent=i,n.cells[2].textContent=a,n.cells[3].textContent=r}onClickDeleteStatement(){this.statements.splice(this.gfx.selectedIndex(),1),this.refresh(this.statements)}onClickAddStatement(){var e=(new Date).getTime(),e=new Statement(e,"New statement",Statement.EXPENSE);this.statements.unshift(e),this.refresh(this.statements)}onClickShowStatement(e,t){this.gfx.onClickSetSlice(t);t=t.currentTarget.textContent;e.firstChild.nodeValue=t+" ",e.click()}onClickChangeStatementType(e){e=e.currentTarget.textContent;this.statements[this.gfx.selectedIndex()].type=e,this.refresh(this.statements)}onClickEdit(){var t=document.querySelectorAll('[editable="true"]');for(let e=0;e<t.length;e+=1)t[e].contentEditable="true";var n=document.querySelectorAll('[hideable="true"]');for(let e=0;e<n.length;e+=1)n[e].style.display="";this.editMode=!0,this.editButton.parentNode.replaceChild(this.saveButton,this.editButton)}onClickSave(){var t=document.querySelectorAll('[editable="true"]');for(let e=0;e<t.length;e+=1)t[e].contentEditable="false";var n=document.querySelectorAll('[hideable="true"]');for(let e=0;e<n.length;e+=1)n[e].style.display="none";this.onClickUpdate&&this.onClickUpdate(this.id,this.statements),this.editMode=!1,this.saveButton.parentNode.replaceChild(this.editButton,this.saveButton)}onClickDropup(e,t){t.currentTarget.classList.toggle("active");t=e.style;"none"===t.display?t.display="block":t.display="none"}onKeyUpStatementName(e){var t=e.currentTarget.textContent;e.currentTarget.parentNode.userData.name=t}onClickAddCategory(){var e=(new Date).getTime(),e=new Category(e,"New Category");this.statements[this.gfx.selectedIndex()].categories.push(e),this.refresh(this.statements)}onClickDeleteCategory(e){var e=e.currentTarget.parentNode.parentNode.parentNode.parentNode,t=e.userData,n=e.parentNode.userData;n.categories.splice(n.categories.indexOf(t),1),e.parentNode.removeChild(e)}onKeyUpCategoryName(e){var t=e.currentTarget.textContent;e.currentTarget.parentNode.parentNode.parentNode.userData.name=t}onClickAddGoal(e){var e=e.currentTarget,t={id:(new Date).getTime(),name:"New Goal",daily:0,monthly:0,yearly:0},e=e.parentNode.parentNode.parentNode.parentNode,n=e.tBodies[0].rows.length-1,s=createImageButton("Delete",[],icons.delete,void 0,this.onClickDeleteGoal.bind(this));this.sketchRow(e,t,{index:n,lastCellContent:s}),e.userData.goals.push(t)}onKeyUpGoal(e){var t=e.currentTarget,n=t.parentNode,s=n.parentNode.parentNode,e=e.currentTarget["cellIndex"],i=n.userData;switch(e){case 0:i.itemName=t.textContent;break;case 1:i.daily=parseInt(t.textContent,10),i.monthly=30*i.daily,i.yearly=365*i.daily,t.parentNode.cells[2].textContent=i.monthly,t.parentNode.cells[3].textContent=i.yearly;break;case 2:i.monthly=parseInt(t.textContent,10),i.daily=Math.ceil(i.monthly/30),i.yearly=12*i.monthly,t.parentNode.cells[1].textContent=i.daily,t.parentNode.cells[3].textContent=i.yearly;break;case 3:i.yearly=parseInt(t.textContent,10),i.daily=Math.ceil(i.yearly/365),i.monthly=Math.ceil(i.yearly/12),t.parentNode.cells[1].textContent=i.daily,t.parentNode.cells[2].textContent=i.monthly}this.recomputeTotal(s)}onClickDeleteGoal(e){var e=e.currentTarget.parentNode.parentNode,t=e.parentNode,n=e.userData,s=e.parentNode.parentNode.userData;s.goals.splice(s.goals.indexOf(n),1),t.removeChild(e),this.recomputeTotal(t.parentNode)}}class PlanningController{#caches=void 0;async init(e){var t=e||(new Date).getFullYear();this.#caches=await PlanningCache.getAll();let n;for(let e=0;e<this.#caches.length;e+=1)this.#caches[e].year===""+t&&(n=this.#caches[e]);e=await this.initPlanningScreen(n);e.init(),e.activate()}async initPlanningScreen(e){var t=await e.readAll(),e=new PlanningScreen(e.year,t);return e.onClickUpdate=this.onClickUpdate.bind(this),e}async onClickUpdate(t,n){for(let e=0;e<this.#caches.length;e+=1)this.#caches[e].year===t&&this.#caches[e].updateAll(n)}}export{PlanningController as default};