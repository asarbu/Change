class Idb{static#READ_ONLY="readonly";static#READ_WRITE="readwrite";constructor(t,e,s){this.dbName=t,this.dbVersion=e,this.upgradeCallback=s}async init(){return await this.open(this.dbName,this.dbVersion,this.upgradeCallback),this}open(i,n,a){return new Promise((e,s)=>{var t;window.indexedDB&&((t=indexedDB.open(i,n)).onsuccess=t=>{t=t.target.result;this.db=t,e(t)},t.onerror=t=>{s(new Error("Database error: "+t.target.errorCode))},t.onupgradeneeded=t=>{var e=t.target.result;a&&a(e,t.oldVersion,t.newVersion)})})}openCursor(n){return new Promise(t=>{var e=this.getStoreTransaction(n,Idb.#READ_ONLY),s=e[0],e=e[1];const i=[];s.openCursor().onsuccess=t=>{t=t.target.result;t&&(i.push(t.value),t.continue())},e.oncomplete=()=>{t(i)}})}insert(n,a,r){return new Promise((e,s)=>{var t=this.getStoreTransaction(n,Idb.#READ_WRITE)[0];let i;(i=r?t.put(a,r):t.put(a)).onsuccess=t=>{e([t.target.result,a])},i.onerror=t=>{s(t.target.errorCode)}})}get(t,i){return new Promise((e,s)=>{this.getStoreTransaction(t,Idb.#READ_ONLY)[0].get(i).onsuccess=t=>{t.target.result?(t=t.target.result,e(t)):s(new Error(`The value with key ${i} not found`))}})}getAllByIndex(n,a,r){return new Promise(t=>{var e=this.getStoreTransaction(n,Idb.#READ_ONLY),s=e[0],e=e[1];const i=[];s.index(a).openCursor(r).onsuccess=t=>{t=t.target.result;t&&(i.push({key:t.primaryKey,value:t.value}),t.continue())},e.oncomplete=()=>{t(i)}})}count(s){return new Promise(t=>{const e=this.getStoreTransaction(s,Idb.#READ_ONLY)[0].count();e.onsuccess=()=>{t(e.result)}})}clear(i){return new Promise((e,s)=>{var t=this.getStoreTransaction(i,Idb.#READ_WRITE)[0].clear();t.onsuccess=t=>{e(t.target.result)},t.onerror=t=>{s(t.target.errorCode)}})}delete(i,n){return new Promise((e,s)=>{var t=this.getStoreTransaction(i,Idb.#READ_WRITE)[0].delete(n);t.onsuccess=t=>{e(t.target.result)},t.onerror=t=>{s(t)}})}async putAll(a,r){return new Promise(e=>{var[s,t]=this.getStoreTransaction(a,Idb.#READ_WRITE);for(let t=0;t<r.length;t+=1){var i=r[t],n=r[t].id;n?s.put(i,n):s.put(i)}t.oncomplete=t=>{e([t.target.result])}})}async updateAll(n,a){return new Promise(e=>{var[s,t]=this.getStoreTransaction(n,Idb.#READ_WRITE);for(let t=0;t<a.length;t+=1){var i=a[t];s.put(i.value,i.key)}t.oncomplete=t=>{e([t.target.result])}})}hasObjectStore(t){return!!this.db.objectStoreNames.contains(t)}getObjectStores(){return this.db.objectStoreNames}getStoreTransaction(t,e){if(this.db.objectStoreNames.contains(t))return[(e=this.db.transaction(t,e)).objectStore(t),e]}}class Statement{static INCOME="Income";static EXPENSE="Expense";static SAVING="Saving";constructor(t,e,s){this.id=t,this.name=e,this.type=s,this.categories=[]}}class Category{constructor(t,e){this.id=t,this.name=e,this.goals=[]}}class PlanningCache{static DATABASE_NAME="Planning";static PLANNING_TEMPLATE_URI="static/v2/js/planning.json";static DATABASE_VERSION=2024;static async getAll(){var e=new Idb(PlanningCache.DATABASE_NAME,PlanningCache.DATABASE_VERSION,PlanningCache.upgradePlanningDatabase),s=(await e.init(),e.getObjectStores()),i=new Array(s.length);for(let t=0;t<s.length;t+=1){var n=s[t],n=new PlanningCache(n,e);await n.init(),i[t]=n}return i}static upgradePlanningDatabase(t,e,s){s&&t.createObjectStore(s,{autoIncrement:!0}).createIndex("byType","type",{unique:!1})}constructor(t,e){this.idb=e,this.storeName=t}async init(){await this.idb.init(),0===await this.idb.count(this.storeName)&&await fetch(PlanningCache.PLANNING_TEMPLATE_URI).then(t=>t.json()).then(t=>this.idb.putAll(this.storeName,t))}async readAll(){return this.idb.openCursor(this.storeName)}async updateAll(t){await this.idb.clear(this.storeName),await this.idb.putAll(this.storeName,t)}async readExpenses(){var t=IDBKeyRange.only("Expense");return this.idb.getAllByIndex(this.storeName,"byType",t)}async readCategories(){return this.idb.openCursor(this.storeName)}async read(t){return this.idb.get(this.storeName,t)}async update(t,e){await this.idb.insert(this.storeName,e,t)}async delete(t){await this.idb.delete(this.storeName,t)}}class GraphicEffects{constructor(){this.rootContainer=void 0,this.mouseDown=!1,this.scrolling=void 0,this.currentIndex=1,this.startX=0,this.startY=0,this.startSliderEventListener=this.startSlider.bind(this),this.moveSliderEventListener=this.moveSlider.bind(this),this.endSliderEventListener=this.endSlider.bind(this),this.refreshEventListener=this.refresh.bind(this),this.navOpen=!1}init(t){this.rootContainer=t,this.sliderWrapper=this.rootContainer.querySelector(".section"),this.lastIndex=this.sliderWrapper.children.length+1,this.slices=this.rootContainer.querySelectorAll(".slice"),this.slices.forEach((t,e)=>{t.setAttribute("data-slice-index",e)}),this.currentIndex=0,this.sliderWrapper.addEventListener("mousedown",this.startSliderEventListener),this.sliderWrapper.addEventListener("touchmove",this.startSliderEventListener,{passive:!0}),window.addEventListener("mouseup",this.endSliderEventListener),window.addEventListener("touchend",this.endSliderEventListener),window.addEventListener("resize",this.refreshEventListener,!0),this.$main=document.getElementById("main"),this.$sidenav_left=document.getElementById("sidenav"),this.$sidenav_right=this.$sidenav_left.cloneNode(!0),this.$sidenav_left.classList.add("sidenav-left"),this.$sidenav_right.classList.add("sidenav-right"),this.$sidenav_left.parentNode.appendChild(this.$sidenav_right),document.querySelectorAll(".nav-trigger").forEach(t=>t.addEventListener("click",this.openNav.bind(this)))}slideTo(t){this.containerWidth||(this.containerWidth=this.rootContainer.clientWidth),this.currentIndex=+t,this.currentIndex=Math.min(this.currentIndex,this.lastIndex),requestAnimationFrame(()=>{this.sliderWrapper.style.transition="transform 0.2s linear",this.sliderWrapper.style.transform=`translateX(${-this.containerWidth*t}px)`})}selectedIndex(){return this.currentIndex}onClickSetSlice(t){t=t.target.getAttribute("data-slice-index");this.slideTo(t)}startSlider(t){this.mouseDown=!0,this.containerWidth||(this.containerWidth=this.rootContainer.clientWidth),this.startX=t.clientX||t.touches[0].screenX,this.startY=t.clientY||t.touches[0].screenY,this.sliderWrapper.removeEventListener("touchmove",this.startSliderEventListener),this.sliderWrapper.style.transition="transform 0s linear",this.rootContainer.addEventListener(t.clientX?"mousemove":"touchmove",this.moveSliderEventListener,{passive:!0})}moveSlider(t){if(this.mouseDown){const e=t.clientX||t.touches[0].screenX,s=t.clientY||t.touches[0].screenY;requestAnimationFrame(()=>{if(!this.scrolling){if(10<Math.abs(s-this.startY))return this.scrolling="vertical",void this.slideTo(this.currentIndex);10<Math.abs(e-this.startX)&&(this.scrolling="horizontal")}var t;void 0!==this.scrolling&&"horizontal"!==this.scrolling||(t=e-this.startX-this.containerWidth*this.currentIndex,this.sliderWrapper.style.transform=`translateX(${t}px)`)})}}endSlider(e){if(this.mouseDown&&e){if(this.mouseDown=!1,"horizontal"===this.scrolling){let t=e.clientX;e=(t=!t&&e.changedTouches?e.changedTouches[0].screenX:t)-this.startX||0;50<e&&0<this.currentIndex?--this.currentIndex:e<-50&&this.currentIndex<this.lastIndex-2&&(this.currentIndex+=1),this.slideTo(this.currentIndex)}this.sliderWrapper.addEventListener("touchmove",this.startSliderEventListener,{passive:!0}),this.scrolling=void 0}}refresh(){this.containerWidth=this.rootContainer.clientWidth,this.slideTo(this.currentIndex)}openNav(t){t=t.target.dataset.side;if("left"===t){if("left"===this.navOpen)return void this.closeNav();this.$sidenav_right.classList.remove("sidenav-open"),this.$sidenav_left.classList.add("sidenav-open"),this.$main.classList.remove("main-shift-right"),this.$main.classList.add("main-shift-left"),this.navOpen="left"}else if("right"===t){if("right"===this.navOpen)return void this.closeNav();this.$sidenav_left.classList.remove("sidenav-open"),this.$sidenav_right.classList.add("sidenav-open"),this.$main.classList.remove("main-shift-left"),this.$main.classList.add("main-shift-right"),this.navOpen="right"}this.$main.addEventListener("transitionend",function t(){this.$main.removeEventListener("transitionend",t),this.refresh()}.bind(this))}closeNav(){this.$sidenav_left.classList.remove("sidenav-open"),this.$sidenav_right.classList.remove("sidenav-open"),this.$main.classList.remove("main-shift-left"),this.$main.classList.remove("main-shift-right"),this.navOpen=void 0,this.$main.addEventListener("transitionend",function t(){this.$main.removeEventListener("transitionend",t),this.refresh()}.bind(this))}}function create(t,e,s){const i=document.createElement(t);return e&&Object.entries(e).forEach(([t,e])=>{"classes"===t?i.classList.add(...e):i[t]=e}),s&&s.appendChild(i),i}function createChild(t,e){t=document.createElement(t);return e.appendChild(t),t}function createImageButton(t,e,s,i,n){var a=create("button"),e=(a.classList.add(...e),create("img"));return e.classList.add("white-fill"),e.textContent=t,e.alt=t,e.src=s,a.appendChild(e),i&&i.appendChild(a),n&&a.addEventListener("click",n),a}class icons{static save="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z' /%3E%3C/svg%3E";static edit="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z' /%3E%3C/svg%3E";static delete="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z' /%3E%3C/svg%3E";static delete_file="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M22.54 21.12L20.41 19L22.54 16.88L21.12 15.46L19 17.59L16.88 15.46L15.46 16.88L17.59 19L15.46 21.12L16.88 22.54L19 20.41L21.12 22.54M6 2C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H13.81C13.45 21.38 13.2 20.7 13.08 20H6V4H13V9H18V13.08C18.33 13.03 18.67 13 19 13C19.34 13 19.67 13.03 20 13.08V8L14 2M8 12V14H16V12M8 16V18H13V16Z' /%3E%3C/svg%3E";static menu="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z' /%3E%3C/svg%3E";static add_row="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M22,10A2,2 0 0,1 20,12H4A2,2 0 0,1 2,10V3H4V5H8V3H10V5H14V3H16V5H20V3H22V10M4,10H8V7H4V10M10,10H14V7H10V10M20,10V7H16V10H20M11,14H13V17H16V19H13V22H11V19H8V17H11V14Z' /%3E%3C/svg%3E";static add_table="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12.35 20H10V17H12.09C12.21 16.28 12.46 15.61 12.81 15H10V12H14V13.54C14.58 13 15.25 12.61 16 12.35V12H20V12.35C20.75 12.61 21.42 13 22 13.54V5C22 3.9 21.1 3 20 3H4C2.9 3 2 3.9 2 5V20C2 21.1 2.9 22 4 22H13.54C13 21.42 12.61 20.75 12.35 20M16 7H20V10H16V7M10 7H14V10H10V7M8 20H4V17H8V20M8 15H4V12H8V15M8 10H4V7H8V10M17 14H19V17H22V19H19V22H17V19H14V17H17V14' /%3E%3C/svg%3E";static add_file="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M23 18H20V15H18V18H15V20H18V23H20V20H23M6 2C4.89 2 4 2.9 4 4V20C4 21.11 4.89 22 6 22H13.81C13.45 21.38 13.2 20.7 13.08 20H6V4H13V9H18V13.08C18.33 13.03 18.67 13 19 13C19.34 13 19.67 13.03 20 13.08V8L14 2M8 12V14H16V12M8 16V18H13V16Z' /%3E%3C/svg%3E";static add="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z' /%3E%3C/svg%3E";static summary="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z' /%3E%3C/svg%3E"}class PlanningScreen{onClickUpdate=void 0;constructor(t,e){this.statements=e,this.id=t,this.editMode=!1}init(){this.gfx=new GraphicEffects,this.container=this.sketchAsFragment(),this.navbar=this.sketchNavBar()}sketchAsFragment(){var t=create("div",{id:this.id,classes:["container"]}),e=create("div",{classes:["section"]});for(let t=0;t<this.statements.length;t+=1){var s=this.statements[t],i=this.sketchStatement(s);i.userData=s,e.appendChild(i)}return t.appendChild(e),t}sketchStatement(t){var e=create("div",{classes:["slice"]}),s=create("h1",{textContent:t.name}),i=(s.setAttribute("editable","true"),s.addEventListener("keyup",this.onKeyUpStatementName.bind(this),!1),this.editMode&&s.setAttribute("contenteditable","true"),create("span",{textContent:"▼",classes:["white-50"]})),n=create("div",{classes:["dropdown-content","top-round","bot-round"]}),a=(n.style.display="none",create("h2",{classes:[],textContent:this.statements[0].type+" "})),r=(a.addEventListener("click",this.onClickDropup.bind(this,n)),a.setAttribute("hideable","true"),this.editMode||(a.style.display="none"),create("div",{textContent:Statement.EXPENSE})),r=(r.addEventListener("click",this.onClickChangeStatementType.bind(this)),n.appendChild(r),create("div",{textContent:Statement.INCOME})),r=(r.addEventListener("click",this.onClickChangeStatementType.bind(this)),n.appendChild(r),create("div",{textContent:Statement.SAVING})),r=(r.addEventListener("click",this.onClickChangeStatementType.bind(this)),n.appendChild(r),a.appendChild(i),a.appendChild(n),createImageButton("Add Category",[],icons.add_table,void 0,this.onClickAddCategory.bind(this))),i=(r.setAttribute("hideable","true"),this.editMode||(r.style.display="none"),e.appendChild(s),e.appendChild(a),this.sketchCategory(t.categories));return e.appendChild(i),e.appendChild(r),e}sketchCategory(e){var s=document.createDocumentFragment();for(let t=0;t<e.length;t+=1){var i=e[t],n=create("table",{id:i.id,classes:["top-round","bot-round"]}),a=(s.appendChild(n),createChild("thead",n)),a=(createChild("tbody",n),n.userData=i,createChild("tr",a)),r=create("th",{textContent:i.name},a),r=(r.setAttribute("editable","true"),this.editMode&&r.setAttribute("contenteditable","true"),r.addEventListener("keyup",this.onKeyUpCategoryName.bind(this),!1),create("th",{textContent:"Daily"},a),create("th",{textContent:"Monthly"},a),create("th",{textContent:"Yearly"},a),createChild("th",a));createImageButton("Delete Row",[],icons.delete,r,this.onClickDeleteCategory.bind(this)),r.setAttribute("hideable","true"),this.editMode||(r.style.display="none");for(let t=0;t<i.goals.length;t+=1){var o=i.goals[t],l=createImageButton("Delete goal",[],icons.delete,void 0,this.onClickDeleteGoal.bind(this));this.sketchRow(n,o,{index:-1,hideLastCell:!0,lastCellContent:l})}this.recomputeTotal(n,!0)}return s}sketchRow(t,e,s){let i=-1;Object.prototype.hasOwnProperty.call(s,"index")&&(i=s.index);t=t.tBodies[0].insertRow(i),t.id=e.id,t.userData=e,this.sketchDataCell(t,e.name,s),this.sketchDataCell(t,e.daily,s),this.sketchDataCell(t,e.monthly,s),this.sketchDataCell(t,e.yearly,s),e=t.insertCell(-1);return s?.lastCellContent&&e.appendChild(s.lastCellContent),e.setAttribute("hideable","true"),s?.hideLastCell&&!this.editMode&&(e.style.display="none"),t}sketchDataCell(t,e,s){t=t.insertCell(-1);return t.textContent=e,s?.readonly||(t.setAttribute("editable","true"),this.editMode&&t.setAttribute("contenteditable","true"),t.addEventListener("keyup",this.onKeyUpGoal.bind(this),!1)),s?.color&&(t.style.color=s.color),t}activate(){var t=document.getElementById("main");t.appendChild(this.container),t.appendChild(this.navbar),this.gfx.init(this.container)}sketchNavBar(){var t=create("nav"),e=create("div",{classes:["nav-header"]},t),s=createImageButton("Add",["nav-item"],icons.add_file,e,this.onClickAddStatement.bind(this)),e=(this.editButton=createImageButton("Edit",["nav-item"],icons.edit,e,this.onClickEdit.bind(this)),this.saveButton=createImageButton("Save",["nav-item"],icons.save,void 0,this.onClickSave.bind(this)),createImageButton("Add",["nav-item"],icons.delete_file,e,this.onClickDeleteStatement.bind(this))),s=(s.style.display="none",s.setAttribute("hideable",!0),e.style.display="none",e.setAttribute("hideable",!0),create("div",{classes:["nav-footer"]},t)),e=(createImageButton("Menu",["nav-item","nav-trigger"],icons.menu,s).setAttribute("data-side","left"),create("button",{textContent:this.id+" ",classes:["dropup","nav-item"]},s),create("span",{textContent:"▲",classes:["white-50"]})),i=create("button",{classes:["nav-item"],textContent:this.statements[0].name+" "},s),n=create("div",{classes:["dropup-content","top-round"]});n.style.display="none",i.addEventListener("click",this.onClickDropup.bind(this,n));for(let t=0;t<this.statements.length;t+=1){var a=create("div",{textContent:this.statements[t].name});a.setAttribute("data-slice-index",t),a.addEventListener("click",this.onClickShowStatement.bind(this,i)),n.appendChild(a)}return i.appendChild(e),t.appendChild(n),createImageButton("Menu",["nav-item","nav-trigger"],icons.menu,s).setAttribute("data-side","right"),t}refresh(t){this.statements=t;t=this.sketchAsFragment();document.getElementById("main").replaceChild(t,this.container),this.container=t}recomputeTotal(e,t=!1){let s;var i={id:e.id+"Total",name:"Total",daily:0,monthly:0,yearly:0};s=t?(t=createImageButton("Delete goal",["nav-item"],icons.add_row,void 0,this.onClickAddGoal.bind(this)),this.sketchRow(e,i,{readonly:!0,hideLastCell:!0,lastCellContent:t})):e.tBodies[0].rows[e.tBodies[0].rows.length-1];let n=0,a=0,r=0;for(let t=0;t<e.tBodies[0].rows.length-1;t+=1){var o=e.tBodies[0].rows[t];n+=parseInt(o.cells[1].textContent,10),a+=parseInt(o.cells[2].textContent,10),r+=parseInt(o.cells[3].textContent,10)}s.cells[1].textContent=n,s.cells[2].textContent=a,s.cells[3].textContent=r}onClickDeleteStatement(){this.statements.splice(this.gfx.selectedIndex(),1),this.refresh(this.statements)}onClickAddStatement(){var t=(new Date).getTime(),t=new Statement(t,"New statement",Statement.EXPENSE);this.statements.unshift(t),this.refresh(this.statements)}onClickShowStatement(t,e){this.gfx.onClickSetSlice(e);e=e.currentTarget.textContent;t.firstChild.nodeValue=e+" ",t.click()}onClickChangeStatementType(t){t=t.currentTarget.textContent;this.statements[this.gfx.selectedIndex()].type=t,this.refresh(this.statements)}onClickEdit(){var e=document.querySelectorAll('[editable="true"]');for(let t=0;t<e.length;t+=1)e[t].contentEditable="true";var s=document.querySelectorAll('[hideable="true"]');for(let t=0;t<s.length;t+=1)s[t].style.display="";this.editMode=!0,this.editButton.parentNode.replaceChild(this.saveButton,this.editButton)}onClickSave(){var e=document.querySelectorAll('[editable="true"]');for(let t=0;t<e.length;t+=1)e[t].contentEditable="false";var s=document.querySelectorAll('[hideable="true"]');for(let t=0;t<s.length;t+=1)s[t].style.display="none";this.onClickUpdate&&this.onClickUpdate(this.id,this.statements),this.editMode=!1,this.saveButton.parentNode.replaceChild(this.editButton,this.saveButton)}onClickDropup(t,e){e.currentTarget.classList.toggle("active");e=t.style;"none"===e.display?e.display="block":e.display="none"}onKeyUpStatementName(t){var e=t.currentTarget.textContent;t.currentTarget.parentNode.userData.name=e}onClickAddCategory(){var t=(new Date).getTime(),t=new Category(t,"New Category");this.statements[this.gfx.selectedIndex()].categories.push(t),this.refresh(this.statements)}onClickDeleteCategory(t){var t=t.currentTarget.parentNode.parentNode.parentNode.parentNode,e=t.userData,s=t.parentNode.userData;s.categories.splice(s.categories.indexOf(e),1),t.parentNode.removeChild(t)}onKeyUpCategoryName(t){var e=t.currentTarget.textContent;t.currentTarget.parentNode.parentNode.parentNode.userData.name=e}onClickAddGoal(t){var t=t.currentTarget,e={id:(new Date).getTime(),name:"New Goal",daily:0,monthly:0,yearly:0},t=t.parentNode.parentNode.parentNode.parentNode,s=t.tBodies[0].rows.length-1,i=createImageButton("Add Row",[],icons.delete,void 0,this.onClickDeleteGoal.bind(this));this.sketchRow(t,e,{index:s,lastCellContent:i}),t.userData.goals.push(e)}onKeyUpGoal(t){var e=t.currentTarget,s=e.parentNode,i=s.parentNode.parentNode,t=t.currentTarget["cellIndex"],n=s.userData;switch(t){case 0:n.itemName=e.textContent;break;case 1:n.daily=parseInt(e.textContent,10),n.monthly=30*n.daily,n.yearly=365*n.daily,e.parentNode.cells[2].textContent=n.monthly,e.parentNode.cells[3].textContent=n.yearly;break;case 2:n.monthly=parseInt(e.textContent,10),n.daily=Math.ceil(n.monthly/30),n.yearly=12*n.monthly,e.parentNode.cells[1].textContent=n.daily,e.parentNode.cells[3].textContent=n.yearly;break;case 3:n.yearly=parseInt(e.textContent,10),n.daily=Math.ceil(n.yearly/365),n.monthly=Math.ceil(n.yearly/12),e.parentNode.cells[1].textContent=n.daily,e.parentNode.cells[2].textContent=n.monthly}this.recomputeTotal(i)}onClickDeleteGoal(t){var t=t.currentTarget.parentNode.parentNode,e=t.parentNode,s=t.userData,i=t.parentNode.parentNode.userData;i.goals.splice(i.goals.indexOf(s),1),e.removeChild(t),this.recomputeTotal(e.parentNode)}}class PlanningController{#caches=void 0;constructor(){}async init(t){var e=t||(new Date).getFullYear();this.#caches=await PlanningCache.getAll();let s;for(let t=0;t<this.#caches.length;t+=1)this.#caches[t].storeName===e&&(s=this.#caches[t]);t=await this.initPlanningScreen(s);t.init(),t.activate()}async initPlanningScreen(t){var e=await t.readAll(),t=new PlanningScreen(t.storeName,e);return t.onClickUpdate=this.onClickUpdate.bind(this),t}async onClickUpdate(e,s){for(let t=0;t<this.#caches.length;t+=1)this.#caches[t].storeName===e&&this.#caches[t].updateAll(s)}}export{PlanningController as default};